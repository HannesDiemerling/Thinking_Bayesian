---
title: "1. Prior Predictive Checks"
format: html
---

## Zeit: 10 min | Schwierigkeit: Einsteiger

### Theorie: Das Wissen vor den Daten
In der Bayes-Statistik beginnen wir nicht bei Null. Wir beginnen mit einem "Prior" – einer Annahme darüber, wie die Welt funktioniert, bevor wir auch nur einen Datenpunkt gesehen haben.

Unser Modell ist eine lineare Beziehung:
$$y_i = \alpha + \beta x_i + \epsilon$$

* **$\alpha$ (Alpha):** Der Schnittpunkt. Wie hoch sind die Verkäufe, wenn wir **nichts** (0€) für Werbung ausgeben?
* **$\beta$ (Beta):** Die Steigung. Wie viele zusätzliche Verkäufe bringt uns jeder Euro Werbung?

### Das Problem: Unmögliche Welten
Wenn wir dem Modell sagen "Ich habe keine Ahnung", wählt es oft absurde Parameter. Ein komplett uninformierter Prior würde zulassen, dass Werbung zu negativen Verkäufen führt. Das ist physikalisch unmöglich. Wir nutzen **Prior Predictive Checks**, um solche "unmöglichen Welten" auszusortieren, bevor das Modell rechnet.

### Ihre Aufgabe
Die Simulation unten zeigt 50 mögliche Realitäten basierend auf Ihren aktuellen Einstellungen.
1.  **Beobachten:** Aktuell landen viele Linien im roten Bereich ("Forbidden Zone"). Das bedeutet negative Verkäufe.
2.  **Korrigieren:** Verringern Sie die Unsicherheit (`SD`), sodass die Linien zwar streuen, aber die rote Zone kaum noch berühren.
3.  **Verstehen:** Verschieben Sie den `Mean` von Beta ins Negative. Macht das Sinn? (Schadet Werbung dem Verkauf?)

```{shinylive-python}
#| standalone: true
#| viewerHeight: 600

from shiny import App, render, ui
import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import norm

app_ui = ui.page_fluid(
    ui.card(
        ui.card_header("Prior Konfiguration"),
        ui.layout_columns(
            ui.div(
                ui.h5("Parameter Alpha (Basis)"),
                ui.input_slider("alpha_mean", "Erwartungswert (Mean)", 0, 100, 10),
                ui.input_slider("alpha_sd", "Unsicherheit (SD)", 0.1, 50, 40),
                ui.hr(),
                ui.h5("Parameter Beta (Steigung)"),
                ui.input_slider("beta_mean", "Erwartungswert (Mean)", -10, 10, 0),
                ui.input_slider("beta_sd", "Unsicherheit (SD)", 0.1, 20, 15),
            ),
            ui.output_plot("prior_plot"),
            col_widths=(4, 8)
        )
    )
)

def server(input, output, session):
    @render.plot
    def prior_plot():
        # Parameter holen
        a_m, a_s = input.alpha_mean(), input.alpha_sd()
        b_m, b_s = input.beta_mean(), input.beta_sd()
        
        # Simulation
        n_samples = 50
        np.random.seed(42) 
        alphas = norm.rvs(a_m, a_s, size=n_samples)
        betas = norm.rvs(b_m, b_s, size=n_samples)
        
        x = np.linspace(0, 10, 100)
        
        fig, ax = plt.subplots(figsize=(10, 6))
        
        # Forbidden Zone
        ax.fill_between(x, -100, 0, color='#e74c3c', alpha=0.3)
        ax.text(5, -25, "FORBIDDEN ZONE (y < 0)", 
                color='#c0392b', fontsize=12, ha='center', fontweight='bold')

        # Linien plotten
        for a, b in zip(alphas, betas):
            y = a + b * x
            # Check: Geht die Linie unter 0?
            is_bad = np.min(y) < 0
            # Schlechte Linien rot einfärben
            color = '#c0392b' if is_bad else 'black'
            alpha_val = 0.15 if is_bad else 0.3
            ax.plot(x, y, color=color, alpha=alpha_val, linewidth=1.5)
            
        ax.set_ylim(-50, 150)
        ax.set_xlim(0, 10)
        ax.set_xlabel("Werbeausgaben (x)")
        ax.set_ylabel("Verkäufe (y)")
        ax.set_title(f"Prior Predictive Simulation ({n_samples} Samples)")
        ax.grid(True, alpha=0.3)
        
        return fig

app = App(app_ui, server)
```