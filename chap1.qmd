---
title: "1. The Conjugate Balance"
format: html
---

## Prior versus Likelihood Strength
The posterior is the compromise between your prior belief and the data. We use a Beta-Binomial conjugate model here. 
Observe how `seaborn` renders the density overlaps.

```{shinylive-python}
#| standalone: true
#| viewerHeight: 600

from shiny import App, render, ui
import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import beta

# Layout für volle Breite und definierte Höhe
app_ui = ui.page_fluid(
    ui.layout_sidebar(
        ui.sidebar(
            ui.h4("Parameter Wahl"),
            ui.input_slider("alpha", "Prior Alpha (Erfolge)", 1, 50, 5),
            ui.input_slider("beta_param", "Prior Beta (Misserfolge)", 1, 50, 5),
            ui.hr(),
            ui.input_slider("succ", "Daten: Erfolge", 0, 100, 20),
            ui.input_slider("fail", "Daten: Misserfolge", 0, 100, 5),
            width=300
        ),
        ui.card(
            # Wichtig: Explizite Höhe für den Plot setzen, damit er den Platz nutzt
            ui.output_plot("dist_plot", height="500px")
        )
    )
)

def server(input, output, session):
    @render.plot
    def dist_plot():
        # Inputs holen
        a_prior = input.alpha()
        b_prior = input.beta_param()
        data_s = input.succ()
        data_f = input.fail()
        
        # Posterior Berechnung
        a_post = a_prior + data_s
        b_post = b_prior + data_f
        
        # Grid
        x = np.linspace(0, 1, 500)
        
        # Dichten berechnen
        y_prior = beta.pdf(x, a_prior, b_prior)
        y_post = beta.pdf(x, a_post, b_post)
        # Standardisierte Likelihood (Beta(s+1, f+1))
        y_lik = beta.pdf(x, 1 + data_s, 1 + data_f)
        
        # Plotting Setup
        fig, ax = plt.subplots(figsize=(10, 6), dpi=100)
        
        # Styling: Weniger "Box", mehr Daten
        ax.spines['top'].set_visible(False)
        ax.spines['right'].set_visible(False)
        ax.grid(True, axis='y', linestyle=':', alpha=0.6)
        
        # 1. Prior
        ax.plot(x, y_prior, color='#7f8c8d', lw=2, label='Prior Belief')
        ax.fill_between(x, y_prior, color='#7f8c8d', alpha=0.1)
        
        # 2. Likelihood (gestrichelt, da es die Daten repräsentiert)
        ax.plot(x, y_lik, color='#2980b9', lw=2, linestyle='--', label='Likelihood (Standardized)')
        
        # 3. Posterior (Hervorgehoben)
        ax.plot(x, y_post, color='#c0392b', lw=3, label='Posterior')
        ax.fill_between(x, y_post, color='#c0392b', alpha=0.2)
        
        # Mittelwerte für Titel
        mean_prior = a_prior / (a_prior + b_prior)
        mean_post = a_post / (a_post + b_post)
        
        ax.set_title(f"Bayesian Update: Prior Mean {mean_prior:.2f} $\\rightarrow$ Posterior Mean {mean_post:.2f}", 
                     fontsize=14, pad=15)
        ax.set_xlabel("$\\theta$ (Erfolgswahrscheinlichkeit)", fontsize=12)
        ax.set_ylabel("Dichte", fontsize=12)
        
        # Legende sauber positionieren
        ax.legend(frameon=False, loc='upper right', fontsize=11)
        
        return fig

app = App(app_ui, server)
```
