---
title: "1. The Conjugate Balance"
format: html
---

## Prior vs. Likelihood Strength
The posterior is the compromise between your prior belief and the data. We use a Beta-Binomial conjugate model here. 
Observe how `seaborn` renders the density overlaps.

```{shinylive-python}
#| standalone: true
from shiny import App, render, ui
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from scipy.stats import beta
import pandas as pd

app_ui = ui.page_fluid(
    ui.layout_sidebar(
        ui.sidebar(
            ui.h4("Parameters"),
            ui.input_slider("alpha", "Prior Alpha (Success)", 1, 50, 5),
            ui.input_slider("beta_param", "Prior Beta (Failure)", 1, 50, 5),
            ui.hr(),
            ui.input_slider("succ", "Data: Successes", 0, 100, 20),
            ui.input_slider("fail", "Data: Failures", 0, 100, 5)
        ),
        ui.card(
            ui.output_plot("dist_plot")
        )
    )
)

def server(input, output, session):
    @render.plot
    def dist_plot():
        # Parameters
        a_prior = input.alpha()
        b_prior = input.beta_param()
        data_s = input.succ()
        data_f = input.fail()
        
        a_post = a_prior + data_s
        b_post = b_prior + data_f
        
        # Grid
        x = np.linspace(0, 1, 300)
        
        # Dataframe for Seaborn
        # We construct the PDF values manually to overlay them cleanly
        df = pd.DataFrame({
            'x': np.tile(x, 2),
            'y': np.concatenate([
                beta.pdf(x, a_prior, b_prior),
                beta.pdf(x, a_post, b_post)
            ]),
            'Distribution': ['Prior'] * 300 + ['Posterior'] * 300
        })
        
        # Plotting
        sns.set_theme(style="whitegrid")
        fig, ax = plt.subplots(figsize=(10, 6))
        
        # Plot Prior and Posterior
        sns.lineplot(data=df, x='x', y='y', hue='Distribution', 
                     palette={'Prior': 'gray', 'Posterior': 'firebrick'}, 
                     linewidth=2.5, ax=ax)
        
        # Fill areas
        ax.fill_between(x, beta.pdf(x, a_prior, b_prior), color='gray', alpha=0.2)
        ax.fill_between(x, beta.pdf(x, a_post, b_post), color='firebrick', alpha=0.3)
        
        # Likelihood (scaled for visibility)
        lik = beta.pdf(x, 1+data_s, 1+data_f)
        ax.plot(x, lik, linestyle='--', color='blue', alpha=0.6, label='Likelihood (Scaled)')
        
        ax.set_title(f"Update: Prior Mean {a_prior/(a_prior+b_prior):.2f} â†’ Post Mean {a_post/(a_post+b_post):.2f}")
        ax.set_xlabel("Theta (Probability)")
        ax.set_ylabel("Density")
        ax.legend()
        
        return fig

app = App(app_ui, server)
```